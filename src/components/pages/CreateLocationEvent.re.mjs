// Generated by ReScript, PLEASE EDIT WITH CARE

import Zod from "zod";
import * as Form from "../molecules/forms/Form.re.mjs";
import * as Grid from "../vanillaui/atoms/Grid.re.mjs";
import * as Util from "../shared/Util.re.mjs";
import * as React from "react";
import * as DateFns from "date-fns";
import * as Core__Int from "@rescript/core/src/Core__Int.re.mjs";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as FormSection from "../molecules/forms/FormSection.re.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.re.mjs";
import * as Core from "@linaria/core";
import * as FramerMotion from "framer-motion";
import * as RelayRuntime from "relay-runtime";
import * as WaitForMessages from "../shared/i18n/WaitForMessages.re.mjs";
import * as ReactHookForm from "react-hook-form";
import * as ReactRouterDom from "react-router-dom";
import * as React$1 from "@headlessui/react";
import * as JsxRuntime from "react/jsx-runtime";
import * as AppContext from "../layouts/appContext";
import * as RescriptRelay_Fragment from "rescript-relay/src/RescriptRelay_Fragment.re.mjs";
import * as RescriptRelay_Mutation from "rescript-relay/src/RescriptRelay_Mutation.re.mjs";
import * as Zod$1 from "@hookform/resolvers/zod";
import * as CreateLocationEventMutation_graphql from "../../__generated__/CreateLocationEventMutation_graphql.re.mjs";
import * as CreateLocationEvent_location_graphql from "../../__generated__/CreateLocationEvent_location_graphql.re.mjs";

import { css, cx } from '@linaria/core'
;

import { t } from '@lingui/macro'
;

var convertVariables = CreateLocationEventMutation_graphql.Internal.convertVariables;

var convertResponse = CreateLocationEventMutation_graphql.Internal.convertResponse;

var convertWrapRawResponse = CreateLocationEventMutation_graphql.Internal.convertWrapRawResponse;

RescriptRelay_Mutation.commitMutation(convertVariables, CreateLocationEventMutation_graphql.node, convertResponse, convertWrapRawResponse);

var use = RescriptRelay_Mutation.useMutation(convertVariables, CreateLocationEventMutation_graphql.node, convertResponse, convertWrapRawResponse);

var convertFragment = CreateLocationEvent_location_graphql.Internal.convertFragment;

function use$1(fRef) {
  return RescriptRelay_Fragment.useFragment(CreateLocationEvent_location_graphql.node, convertFragment, fRef);
}

var schema = Zod.object({
      title: Zod.string({
              required_error: t`Title is required`
            }).min(1),
      maxRsvps: Zod.number({}).gte(1).optional(),
      startDate: Zod.string({
              required_error: t`Event date is required`
            }).min(1),
      endTime: Zod.string({
              required_error: t`End time is required`
            }).min(5),
      details: Zod.string({}).optional(),
      listed: Zod.boolean({})
    });

function CreateLocationEvent(props) {
  var $$location = use$1(props.location);
  var match = use();
  var commitMutationCreate = match[0];
  var navigate = ReactRouterDom.useNavigate();
  var match$1 = ReactHookForm.useForm({
        resolver: Caml_option.some(Zod$1.zodResolver(schema)),
        defaultValues: {
          listed: false
        }
      });
  var setValue = match$1.setValue;
  var formState = match$1.formState;
  var handleSubmit = match$1.handleSubmit;
  var register = match$1.register;
  var match$2 = React.useState(function () {
        return false;
      });
  var setListedState = match$2[1];
  var listedState = match$2[0];
  React.useEffect((function () {
          var now = new Date();
          var currentISODate = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
          var currentDate = DateFns.parseISO(currentISODate);
          var defaultStartDate = DateFns.format(currentDate, "yyyy-MM-dd'T'HH:00");
          var defaultEndTime = DateFns.format(DateFns.addHours(DateFns.parseISO(defaultStartDate), 2.0), "HH:mm");
          setValue("startDate", defaultStartDate);
          setValue("endTime", defaultEndTime);
        }), []);
  var onSubmit = function (data) {
    var connectionId = RelayRuntime.ConnectionHandler.getConnectionID("client:root", "EventsListFragment_events", undefined);
    var startDate = DateFns.parseISO(data.startDate);
    var endDate = DateFns.parse(data.endTime, "HH:mm", startDate);
    commitMutationCreate({
          connections: [connectionId],
          input: {
            details: Core__Option.getOr(data.details, ""),
            endDate: Util.Datetime.fromDate(endDate),
            listed: data.listed,
            locationId: $$location.id,
            maxRsvps: Core__Option.map(data.maxRsvps, (function (prim) {
                    return prim | 0;
                  })),
            startDate: Util.Datetime.fromDate(startDate),
            title: data.title
          }
        }, undefined, undefined, undefined, (function (response, _errors) {
            Core__Option.map(response.createEvent.event, (function ($$event) {
                    navigate("/events/" + $$event.id, undefined);
                  }));
          }), undefined, undefined);
  };
  return JsxRuntime.jsx(FramerMotion.motion.div, {
              style: {
                opacity: 0,
                y: -50
              },
              animate: {
                opacity: 1,
                scale: 1,
                y: 0.00
              },
              initial: {
                opacity: 0,
                scale: 1,
                y: -50
              },
              exit: {
                opacity: 0,
                scale: 1,
                y: -50
              },
              children: Caml_option.some(JsxRuntime.jsx(WaitForMessages.make, {
                        children: (function () {
                            var match = formState.errors.title;
                            var tmp;
                            if (match !== undefined) {
                              var message = match.message;
                              tmp = message !== undefined ? message : "";
                            } else {
                              tmp = "";
                            }
                            return JsxRuntime.jsx(JsxRuntime.Fragment, {
                                        children: Caml_option.some(JsxRuntime.jsx(Grid.make, {
                                                  className: "grid-cols-1",
                                                  children: JsxRuntime.jsxs("form", {
                                                        children: [
                                                          JsxRuntime.jsx(FormSection.make, {
                                                                title: t`${Core__Option.getOr($$location.name, "?")} Event Details`,
                                                                description: Caml_option.some(t`Details specific to this event on the specified date and time.`),
                                                                children: JsxRuntime.jsxs("div", {
                                                                      children: [
                                                                        JsxRuntime.jsxs("div", {
                                                                              children: [
                                                                                JsxRuntime.jsx(Form.Input.make, {
                                                                                      label: t`Title`,
                                                                                      name: "title",
                                                                                      id: "title",
                                                                                      placeholder: t`All Level Badminton`,
                                                                                      register: register("title", undefined)
                                                                                    }),
                                                                                JsxRuntime.jsx("p", {
                                                                                      children: tmp
                                                                                    })
                                                                              ],
                                                                              className: "col-span-full"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsx(Form.Input.make, {
                                                                                    label: t`Date and Time`,
                                                                                    name: "startDate",
                                                                                    id: "startDate",
                                                                                    type_: "datetime-local",
                                                                                    register: register("startDate", undefined)
                                                                                  }),
                                                                              className: "sm:col-span-2"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsx(Form.Input.make, {
                                                                                    label: t`Date and Time`,
                                                                                    name: "endTime",
                                                                                    id: "endTime",
                                                                                    type_: "time",
                                                                                    register: register("endTime", undefined)
                                                                                  }),
                                                                              className: "sm:col-span-2"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsx(Form.Input.make, {
                                                                                    label: t`Max participants`,
                                                                                    name: "maxRsvps",
                                                                                    id: "maxRsvps",
                                                                                    type_: "number",
                                                                                    register: register("maxRsvps", {
                                                                                          setValueAs: (function (v) {
                                                                                              if (v === "") {
                                                                                                return ;
                                                                                              } else {
                                                                                                return Caml_option.some(Core__Int.fromString(undefined, v));
                                                                                              }
                                                                                            })
                                                                                        })
                                                                                  }),
                                                                              className: "sm:col-span-2"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsx(Form.TextArea.make, {
                                                                                    label: t`Location Details`,
                                                                                    name: "location_details",
                                                                                    id: "location_details",
                                                                                    hint: Caml_option.some(JsxRuntime.jsx(ReactRouterDom.Link, {
                                                                                              to: "/locations/edit/",
                                                                                              children: t`Edit the location to edit the details for this location.`
                                                                                            })),
                                                                                    defaultValue: Core__Option.getOr($$location.details, ""),
                                                                                    disabled: true
                                                                                  }),
                                                                              className: "col-span-full"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsx(Form.TextArea.make, {
                                                                                    label: t`Event Details`,
                                                                                    name: "details",
                                                                                    id: "details",
                                                                                    hint: Caml_option.some(t`Any details from the location will already be included. Mention any additional event-specific instructions, rules, or details.`),
                                                                                    register: register("details", undefined)
                                                                                  }),
                                                                              className: "col-span-full"
                                                                            }),
                                                                        JsxRuntime.jsx("div", {
                                                                              children: JsxRuntime.jsxs(React$1.Switch.Group, {
                                                                                    as: "div",
                                                                                    className: "flex items-center",
                                                                                    children: [
                                                                                      JsxRuntime.jsx(React$1.Switch, {
                                                                                            className: Core.cx(listedState ? "bg-indigo-600" : "bg-gray-200", "relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"),
                                                                                            children: JsxRuntime.jsx("span", {
                                                                                                  "aria-hidden": true,
                                                                                                  className: Core.cx(listedState ? "translate-x-5" : "translate-x-0", "pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out")
                                                                                                }),
                                                                                            checked: listedState,
                                                                                            onChange: (function (param) {
                                                                                                setValue("listed", !listedState);
                                                                                                setListedState(function (param) {
                                                                                                      return !listedState;
                                                                                                    });
                                                                                              })
                                                                                          }),
                                                                                      JsxRuntime.jsxs(React$1.Switch.Label, {
                                                                                            as: "span",
                                                                                            className: "ml-3 text-sm",
                                                                                            children: [
                                                                                              JsxRuntime.jsx("span", {
                                                                                                    children: t`List publicly`,
                                                                                                    className: "font-medium text-gray-900"
                                                                                                  }),
                                                                                              " ",
                                                                                              JsxRuntime.jsx("span", {
                                                                                                    children: t`Show your event publicly on our home page. Otherwise, only people with a link to your event will be able to find it.`,
                                                                                                    className: "text-gray-500"
                                                                                                  })
                                                                                            ]
                                                                                          })
                                                                                    ]
                                                                                  }),
                                                                              className: "col-span-full"
                                                                            })
                                                                      ],
                                                                      className: "mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                                                                    })
                                                              }),
                                                          JsxRuntime.jsx(Form.Footer.make, {})
                                                        ],
                                                        onSubmit: handleSubmit(onSubmit)
                                                      })
                                                }))
                                      });
                          })
                      }))
            });
}

var make = CreateLocationEvent;

export {
  make ,
}
/*  Not a pure module */
